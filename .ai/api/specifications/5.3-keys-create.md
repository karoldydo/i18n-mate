# 5.3 Create Key with Default Value

**Endpoint:** `POST /rest/v1/rpc/create_key_with_value`  
**Description:** Create key in default language with initial value. **Triggers fan-out to all locales.**  
**Authentication:** Required

**Request Body:**

```json
{
  "p_default_value": "Welcome Home",
  "p_full_key": "app.home.title",
  "p_project_id": "uuid"
}
```

**Raw RPC Response (200 OK):**

PostgREST wraps the result in an array (RPC returns TABLE):

```json
[
  {
    "key_id": "uuid"
  }
]
```

**Hook Response:**

The client hook uses `.single()` to extract the first element:

```json
{
  "key_id": "uuid"
}
```

**Error Responses:**

- `400 Bad Request` - Validation error (see validation rules)
- `409 Conflict` - Key already exists in project

**Validation:**

- `full_key`: required, max 256 chars, `[a-z0-9._-]`, no spaces, no `..`, no trailing dot
- Must start with project's `prefix` + `.`
- `default_value`: required (not empty), max 250 chars, no newline
- Trigger `validate_key_prefix_trigger` enforces prefix requirement
- Trigger `trim_translation_value_trigger` auto-trims and converts empty to NULL
- Trigger `validate_default_locale_value_trigger` prevents NULL/empty for default locale

**Business Logic:**

- Function `create_key_with_value()` atomically:
  1. Inserts into `keys` table
  2. Inserts default locale translation with `updated_by_user_id = auth.uid()`
  3. Trigger `fan_out_translations_on_key_insert_trigger` creates NULL translations for all other locales
- Emit `key_created` telemetry event
