# 8.1 Export Project Translations

**Endpoint:** `GET /functions/v1/export-translations?project_id={project_id}`  
**Description:** Export all translations as ZIP with `{locale}.json` files (Supabase Edge Function)  
**Authentication:** Required

**Success Response (200 OK):**

**Headers:**

- `Content-Type: application/zip`
- `Content-Disposition: attachment; filename="project-{name}-{timestamp}.zip"`

**ZIP Contents:**

```
en.json
pl.json
de.json
```

**File Format (`en.json` example):**

```json
{
  "app.home.subtitle": "Get started now",
  "app.home.title": "Welcome Home",
  "app.settings.label": "Settings"
}
```

**Error Responses:**

**401 Unauthorized:**

```json
{
  "data": null,
  "error": {
    "code": 401,
    "message": "Authentication required"
  }
}
```

**404 Not Found:**

```json
{
  "data": null,
  "error": {
    "code": 404,
    "message": "Project not found or access denied"
  }
}
```

**500 Internal Server Error:**

```json
{
  "data": null,
  "error": {
    "code": 500,
    "details": {
      "original": "error"
    },
    "message": "Export generation failed"
  }
}
```

**Business Logic (Edge Function):**

1. Validate project ownership via RLS
2. Fetch all project locales (exclude deleted locales)
3. For each locale:
   - Query all translations: `SELECT full_key, value FROM keys JOIN translations WHERE project_id = ? AND locale = ?`
   - Build flat JSON object with dotted keys
   - Sort keys alphabetically (stable sort)
   - Convert empty/NULL values to `""`
4. Create in-memory ZIP archive
5. Add {locale}.json files with UTF-8 encoding, LF line endings
6. Stream ZIP to response

**Performance:**

- Use streaming for large projects (>10k keys)
- Consider server-side caching (5 min TTL) keyed by `project_id` + `max(updated_at)`
