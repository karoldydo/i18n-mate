# 5.1 List Keys (Default Language View)

**Endpoint:** `GET /rest/v1/rpc/list_keys_default_view`  
**Description:** List keys with default locale values and missing counts. Supports search and missing filter.  
**Authentication:** Required

**Query Parameters:**

- `project_id` - Project UUID (required)
- `search` - Search term for key name (optional, case-insensitive contains). If omitted or empty, no search filter is applied.
- `missing_only` - Filter keys with missing translations (optional, boolean). Default: `false`. `undefined` is treated as `false`.
- `limit` - Items per page (optional, integer). Default: `50`, max: `100`, min: `1`.
- `offset` - Pagination offset (optional, integer). Default: `0`, min: `0`.

**Parameter Behavior Notes:**

- Optional boolean parameters: `undefined` = `false`, omitted = `false`
- Optional string parameters: `undefined` = no filter applied, empty string = no filter applied
- Optional integer parameters: use documented defaults when omitted

**Example Request:**

```
GET /rest/v1/rpc/list_keys_default_view?project_id={uuid}&search=button&missing_only=false&limit=50&offset=0
```

**Raw RPC Response (200 OK):**

PostgREST returns a plain JSON array:

```json
[
  {
    "created_at": "2025-01-15T10:00:00Z",
    "full_key": "app.home.title",
    "id": "uuid",
    "missing_count": 2,
    "value": "Welcome Home"
  },
  {
    "created_at": "2025-01-15T10:01:00Z",
    "full_key": "app.home.subtitle",
    "id": "uuid",
    "missing_count": 0,
    "value": "Get started now"
  }
]
```

**Hook Response:**

The client hook wraps the result with pagination metadata:

```json
{
  "data": [
    {
      "created_at": "2025-01-15T10:00:00Z",
      "full_key": "app.home.title",
      "id": "uuid",
      "missing_count": 2,
      "value": "Welcome Home"
    },
    {
      "created_at": "2025-01-15T10:01:00Z",
      "full_key": "app.home.subtitle",
      "id": "uuid",
      "missing_count": 0,
      "value": "Get started now"
    }
  ],
  "metadata": {
    "end": 1,
    "start": 0,
    "total": 2
  }
}
```

**Error Responses:**

**400 Bad Request (Invalid UUID format for project_id):**

```json
{
  "data": null,
  "error": {
    "code": 400,
    "details": {
      "constraint": "uuid",
      "field": "project_id"
    },
    "message": "Invalid project ID format"
  }
}
```

**400 Bad Request (Invalid pagination params - limit > 100):**

```json
{
  "data": null,
  "error": {
    "code": 400,
    "details": {
      "constraint": "max",
      "field": "limit"
    },
    "message": "Limit must be between 1 and 100"
  }
}
```

**400 Bad Request (Negative offset):**

```json
{
  "data": null,
  "error": {
    "code": 400,
    "details": {
      "constraint": "min",
      "field": "offset"
    },
    "message": "Offset must be non-negative"
  }
}
```

**401 Unauthorized:**

```json
{
  "data": null,
  "error": {
    "code": 401,
    "message": "Authentication required"
  }
}
```

**403 Forbidden:**

```json
{
  "data": null,
  "error": {
    "code": 403,
    "message": "Project not found or access denied"
  }
}
```

**500 Internal Server Error:**

```json
{
  "data": null,
  "error": {
    "code": 500,
    "details": {
      "original": "error"
    },
    "message": "Failed to fetch keys"
  }
}
```

**Business Logic:**

- Query uses trigram index `idx_keys_full_key_trgm` for search performance
- `missing_count` is computed via subquery counting NULL translations
- Default sort: `full_key ASC`

**Notes:**

- **Response Structure:**
  - The RPC function returns a plain JSON array of rows
  - Supabase provides total count via the `count: 'exact'` option
  - Client hooks transform the array into `{ data, metadata }` format
  - `metadata` is built from Supabase's `count`, request `offset`, and array length

- **Field Semantics:**
  - `value` is always non-null (default-locale value enforced by DB trigger `validate_translation_default_locale_insert_trigger`)
  - `missing_count` counts NULL translations across all non-default locales for each key
  - Missing translations are represented as NULL values (empty strings are auto-converted to NULL by `trim_translation_value_insert_trigger`)
